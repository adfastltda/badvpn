#!/bin/bash

# Baixar o badvpn-udpgw
if [ ! -f /bin/badvpn-udpgw ]; then
    echo -e "\033[1;31mBaixando Badvpn...\033[0m"
    wget -O /bin/badvpn-udpgw https://raw.githubusercontent.com/powermx/badvpn/master/badvpn-udpgw &>/dev/null
    chmod +x /bin/badvpn-udpgw
    echo -e "\033[1;32mBadvpn baixado e instalado em /bin/badvpn-udpgw.\033[0m"
else
    echo -e "\033[1;32mBadvpn já está instalado.\033[0m"
fi

# Criar o serviço systemd
echo -e "\033[1;31mCriando serviço systemd para Badvpn...\033[0m"
cat << 'EOF' > /etc/systemd/system/badvpn.service
[Unit]
Description=Badvpn UDP Gateway
After=network.target

[Service]
ExecStart=/bin/badvpn-udpgw --listen-addr 0.0.0.0:7300 --listen-addr 0.0.0.0:7400 --listen-addr 0.0.0.0:7500 --listen-addr 0.0.0.0:7600 --max-clients 1000 --max-connections-for-client 1000 --client-socket-sndbuf 0 --udp-mtu 9000
Restart=always
User=root
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
EOF

# Dar reload no systemd e iniciar o serviço
systemctl daemon-reload
systemctl enable badvpn
systemctl start badvpn

# Mensagem final
echo -e "\033[1;32mBadvpn instalado e rodando via systemd!\033[0m"
echo -e "\033[1;37mUse os seguintes comandos para gerenciar o Badvpn:\033[0m"
echo -e "\033[1;31m systemctl start badvpn\033[0m - \033[1;37mIniciar manualmente\033[0m"
echo -e "\033[1;31m systemctl stop badvpn\033[0m - \033[1;37mParar o serviço\033[0m"
echo -e "\033[1;31m systemctl restart badvpn\033[0m - \033[1;37mReiniciar o serviço\033[0m"
echo -e "\033[1;31m systemctl status badvpn\033[0m - \033[1;37mVer status e logs\033[0m"
